---
date: 2026-01-28
categories:
- technology
---

# FAST-Calib

FAST-Calib 是香港大学 Mars 实验室开源的一套激光雷达与相机外参标定算法。具体内容可参考原仓库 [hku-mars/FAST-Calib](https://github.com/hku-mars/FAST-Calib)。

首先安装依赖：

```bash
sudo apt update

# PCL >= 1.8
sudo apt install libpcl-dev

# OpenCV >= 4.0
sudo apt install libopencv-dev
opencv_version
pkg-config --modversion opencv4
```

然后拉去原仓库并编译：

```bash
mkdir -p ~/calib_ws/src
cd ~/calib_ws/src
git clone https://github.com/hku-mars/FAST-Calib.git
cd ..
catkin_make # or: catkin build
source ~/calib_ws/devel/setup.bash
```

运行 FAST-Calib 的前提：

（1）标定完成相机内参和畸变系数，得到 3x3 内参矩阵和畸变系数，形如：

```yaml
camera_matrix:
    - [fx, 0,  cx]
    - [0,  fy, cy]
    - [0,  0,  1 ]
dist_coeffs: [k1, k2, p1, p2, k3]
```

（2）准备标定板，官方仓库给出的 CAD model 网盘链接为 [text](https://pan.baidu.com/s/14Q2zmEfY6Z2O5Cq4wgVljQ?pwd=2hhn)。

录制数据 bag 包：在静止场景下，保持标定板、相机、LiDAR 固定不动，分别录制包含点云消息的 bag 包和图像，也可以录制包含图像消息的 bag 包然后手动编写 pyhton 脚本提取。准备好后存放于 `calib_data/` 目录中。

在 `config/qr_params.yml` 配置文件中准备自己的各项参数和数据，精简为：

```yaml
# Camera intrinsics
  fx: 2478.48702288166
  fy: 2478.58544825456
  cx: 1230.99707596681
  cy: 1025.66149498072
  k1: -0.0493178189623200
  k2: 0.147394487986097
  p1: -0.00127118592043482
  p2: -0.00200379689523022

# Calibration target parameters
  marker_size: 0.20 # ArUco marker size (our test data uses 0.16m; adjust to match your marker size)
  delta_width_qr_center: 0.55 # Half the distance between the centers of two markers in the horizontal direction
  delta_height_qr_center: 0.35 # Half the distance between the centers of two markers in the vertical direction
  delta_width_circles: 0.5 # Distance between the centers of two circles in the horizontal direction
  delta_height_circles: 0.4 # Distance between the centers of two circles in the vertical direction
  circle_radius: 0.12 # Radius of the circle

# Distance filter
  x_min: 2.0
  x_max: 5.0
  y_min: -1.0
  y_max: 4.0
  z_min: 0.0
  z_max: 2.0

# Input
  lidar_topic: "/livox/lidar" # /ouster/points /livox/lidar
  bag_path: "$(find fast_calib)/calib_data/avia_multi_scene/33.bag"
  image_path: "$(find fast_calib)/calib_data/avia_multi_scene/33.jpg"

# Output
  output_path: "$(find fast_calib)/output"
```

其中 `x_min, x_max, ...` 等几项，分别代表在点云坐标系下，标定板所处的点云 XYZ 坐标范围，这一步手动估计可能误差较大，可运行官方提供的过滤脚本 `scripts/distance_filter.py` ，手动选择若干个位于标定板上的点云，然后自动计算位置，填入到 `config/qr_params.yml` 中。

运行脚本 `scripts/distance_filter.py` 时，需要注意：

1. 源代码最后一部分 Line 326, Line 333 需要自行修改 `topic_name` 为自己录制的点云话题名称。
2. 源代码要求点云格式为 `sensor_msgs/PointCloud2` 或者 `livox_ros_driver/CustomMsg` ，但是 Livox LiDAR 第二代驱动中，点云类型名称为 `livox_ros_driver2/CustomMsg` ，实际上这两代驱动的消息类型完全相同，可以将代码中 Line 155, Line 189 中 `#!py msg._type == "livox_ros_driver/CustomMsg"` 改为 `#!py msg._type == "livox_ros_driver/CustomMsg" or msg._type == "livox_ros_driver2/CustomMsg"` 即可。
3. 脚本运行示例 `#!bash python3 scripts/distance_filter_tool.py /path/to/data.bag /path/to/output_dir` 。
4. 输出的 `livox_CustomMsg_inten_acsii.txt` 文件中，对应的 `x_min, x_max, ...` 等值可以直接复制到 `config/qr_params.yaml` 中。

数据准备好之后，进行单场景标定：

```bash
roslaunch fast_calib calib.launch
```

标定过程中可能会计算出异常结果，伴随这样的报错，提示找不到完整的 4 个 LiDAR 点云角点：

```text
[sortPatternCenters] Number of lidar center points to be sorted is not 4.
[saveTargetHoleCenters] The number of points in lidar_centers or qr_centers is not 4, skip saving.
[pcl::TransformationEstimationSVD::estimateRigidTransformation] Number or points in source (0) differs than target (4)!
[computeRMSE] Point cloud sizes do not match, cannot compute RMSE.
```

目前的解决方法是：参考官方 issue <https://github.com/hku-mars/FAST-Calib/issues/52>，源代码 `src/lidar_detect.hpp` 中 Line 490 的 `#!cpp if (error < 0.025)` 改为 `#!cpp if (error < 0.05)` ，放宽阈值限制，然后重新编译。

如果标定成功，终端会输出信息：

```text
[Record] Saved four pairs of circular hole centers to /home/caesar/calib_ws/src/FAST-Calib/output/0128_mid/circle_center_record.txt
[Result] RMSE: 0.0022 m
[Result] Single-scene calibration: extrinsic parameters T_cam_lidar =
-0.038812 -0.998993 -0.022507 -0.044273
 0.643160 -0.007737 -0.765693 -0.254352
 0.764748 -0.044194  0.642813  0.028078
 0.000000  0.000000  0.000000  1.000000
[Result] Single-scene calibration results saved to /home/caesar/calib_ws/src/FAST-Calib/output/0128_mid/single_calib_result.txt
[Result] Saved colored point cloud to: /home/caesar/calib_ws/src/FAST-Calib/output/0128_mid/colored_cloud.pcd
```

会生成以下文件：

1. `circle_center_record.txt` 包含对标定板中 LiDAR 点云和二维码位置的识别结果。
2. `colored_cloud.pcd`
3. `qr_detect.png`
4. `single_calib_result.txt` 为标定结果，为 LiDAR 到相机的变换矩阵，包含 `R_cl, T_cl` 。

准备至少 3 个以上的数据然后重复单场景标定，就可以运行多场景标定。多场景标定只需要准备 `circle_center_record.txt` 中多组不同的数据即可：

```bash
roslaunch fast_calib multi_calib.launch
```

输出 `multi_calib_result.txt` 文件，终端中会输出以下信息：

```text
[Result] RMSE: 0.0184 m
[Result] Multi-scene calibration: extrinsic parameters T_cam_lidar =
-0.044073 -0.998786 -0.022010 -0.038437
 0.602589 -0.009005 -0.798001 -0.169094
 0.796833 -0.048433  0.602255  0.026581
 0.000000  0.000000  0.000000  1.000000
[Result] Multi-scene calibration results saved to /home/caesar/calib_ws/src/FAST-Calib/output/multi_calib_result.txt
```
